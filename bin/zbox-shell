#!/usr/bin/python3

import subprocess

# noinspection PyUnresolvedReferences
from bin_util import *
from zbox.util import *


@typechecked
def main() -> int:
    args = parse_args()
    docker_cmd = get_docker_command(args)
    container_name = args.container_name
    if not docker_cmd:
        sys.exit("Neither /usr/bin/podman nor /usr/bin/docker found and no -d option provided")

    run_result = subprocess.run([docker_cmd, "exec", "-it", container_name, args.shell])
    if run_result.returncode != 0:
        print_color(f"FAILED in {args.shell} execution on '{container_name}'", fg=fgcolor.red)
        return 1

    return 0


@typechecked
def parse_args() -> argparse.Namespace:
    parser = argparse.ArgumentParser()
    parser.add_argument("-d", "--docker-path", type=str,
                        help="path of docker/podman if not in /usr/bin")
    parser.add_argument("-s", "--shell", type=str, default="/bin/bash",
                        help="run the given shell (default is /bin/bash)")
    parser.add_argument("container_name", type=str, help="name of the running box")
    return parser.parse_args()


sys.exit(main())
